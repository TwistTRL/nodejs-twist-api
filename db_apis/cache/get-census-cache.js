/*
 * @Author: Peng Zeng 
 * @Date: 2020-12-23 13:03:10 
 * @Last Modified by: Peng Zeng
 * @Last Modified time: 2020-12-23 14:19:48
 */

const database = require("../../services/database");

const GET_CENSUS_CACHE_SQL = `
SELECT 
DTUNIX, PERSON_ID, MRN, FIRST_NAME, MIDDLE_NAME, LAST_NAME, BIRTH_UNIX_TS, DECEASED_UNIX_TS, SEX, BED_START_UNIX, BED_END_UNIX,
  LOC_NURSE_UNIT_CD,  LOC_ROOM_CD, NURSE_UNIT_DISP, LOCATION_BED, BED_DISP, ROOM_DISP, ASSIGN_ID, BED_ASSIGN_ID, PATIENT_WEIGHT, 
  WEIGHT_UNIX, E, V, N, INO, AGE_DISPLAY, ANATOMY_DISPLAY, RSS, RST, RSS_UNIX, ECMO_FLOW_NORM, ECMO_VAD_SCORE, ECMO_UNIX,
  TEAM, CHIEF_COMPLAINT, NAME_FULL_FORMATTED, CONTACT_NUM, ASSIGN_TYPE, TEAM_ASSIGN_TYPE, START_UNIX, END_UNIX
FROM API_CACHE_CENSUS 
LEFT JOIN API_CACHE_CENSUS_PERSONNEL USING (PERSONNEL_LIST_ID)
WHERE DTUNIX = (SELECT DISTINCT(DTUNIX) FROM API_CACHE_CENSUS ORDER BY DTUNIX DESC FETCH FIRST 1 ROW ONLY)
`;

const getCensusCacheData = database.withConnection(
    async (conn) => await conn.execute(GET_CENSUS_CACHE_SQL).then((ret) => ret.rows)
);

module.exports = {
  getCensusCacheData,
};
